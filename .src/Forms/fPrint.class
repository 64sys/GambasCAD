' Gambas class file

Public MyPrinter As New Printer
Public cPaperSizes As New Collection

Public snxAreaToPrint As New Single[]

Public Sub Printer1_Draw()

End

Public Sub btnCAncel_Click()

    Me.Close(0)

End

Public Sub Form_Activate()

    ' Obtengo la impresion
    ' frmPrinter.Text = Printer1.Name

    ' es posible que haya vuelto de buscar un area de impresion
    snxAreaToPrint = New Single[]
    snxAreaToPrint.Add(cadSelection.SelStartXr)
    snxAreaToPrint.Add(cadSelection.SelStartYr)
    snxAreaToPrint.Add(cadSelection.SelEndXr)
    snxAreaToPrint.Add(cadSelection.SelEndyr)

End

Public Sub Form_Open()

    ' obtengo la lista de impresoras

    Dim stxPrinters As New String[]
    Dim sSize As Variant

    stxPrinters = Printer.List

    cmbPrinter.List = stxPrinters

    cPaperSizes.Add("A0 841mm X 1189mm", "A0")
    cPaperSizes.Add("A1 594mm X 841mm", "A1")
    cPaperSizes.Add("A2 420mm X 594mm", "A2")
    cPaperSizes.Add("A3 297mm X 420mm", "A3")
    cPaperSizes.Add("A4 210mm X 297mm", "A4")
    cPaperSizes.Add("A5 148mm X 210mm", "A5")
    cPaperSizes.Add("Custom size in mm", "CU")

    For Each sSize In cPaperSizes
        cmbPaperSize.Add(sSize)
    Next

    cmbScale.Add("Custom")
    cmbScale.Add("1000:1")
    cmbScale.Add("200:1")
    cmbScale.Add("100:1")
    cmbScale.Add("75:1")
    cmbScale.Add("50:1")
    cmbScale.Add("20:1")
    cmbScale.Add("10:1")
    cmbScale.Add("1:1")
    cmbScale.Add("1:10")
    cmbScale.Add("1:20")
    cmbScale.Add("1:50")
    cmbScale.Add("1:75")
    cmbScale.Add("1:100")
    cmbScale.Add("1:200")
    cmbScale.Add("1:1000")

End

Public Sub btnPrint_Click()

    ' coloco todo los parametros en el estilo de impresion en uso
    With gcd.currentDrawing.CurrPrintStyle
        .ColorStyle = -((1 * radGray.Value) + (2 * radColor.Value))

        .PrintScale = vlbScalePaper.Value / vlbScaleDraw.Value
        If radFitToPage.Value Then .PrintScale = -1
        .PaperSizeW = vlbWidth.Value
        .PaperSizeH = vlbHeight.Value

        .PrintOffsetX = vlbLeft.Value
        .PrintOffsetY = vlbTop.Value

        .PrintOrientation = -(radLandscape.Value = 0)

        .PrintInvert = chkInvert.Value
        If Me.radAreaWindow.Value Then .PrintArea = 2
        If Me.radAreaAll.Value Then .PrintArea = 0
        If Me.radAreaView.Value Then .PrintArea = 1

        .PrintAreaX0 = snxAreaToPrint[0]
        .PrintAreaY0 = snxAreaToPrint[1]
        .PrintAreaX1 = snxAreaToPrint[2]
        .PrintAreaY1 = snxAreaToPrint[3]

        'MyPrinter.Print()

    End With

    Me.Close(1) ' la impresion se desarrolla en fMain

    fMain.Printer1.Paper = Printer.A4
    fMain.Printer1.OutputFile = User.Home &/ "print.pdf"
    fMain.Printer1.Print

End

Public Sub cmbPaperSize_Click()

    Dim fWidth As Integer
    Dim sParts As String[]

    If Left(cmbPaperSize.Text, 1) = "A" Then

        vlbHeight.Enabled = False
        vlbWidth.Enabled = False
        lblHeight.Enabled = False
        lblWidth.Enabled = False

        sParts = Split(cmbPaperSize.Text, " ")

        vlbWidth.Text = Left(sParts[1], -2)
        vlbHeight.Text = Left(sParts[3], -2)

    Else
        vlbHeight.Enabled = True
        vlbWidth.Enabled = True
        lblHeight.Enabled = True
        lblWidth.Enabled = True

    Endif

End

Public Sub radAreaWindow_Click()

End

Public Sub run()

    Me.Show

End

Public Sub cmbScale_Click()

    Dim sScales As String[]

    If IsNumber(Left(cmbScale.Text, 1)) Then
        sScales = Split(cmbScale.Text, ":")

        lblScale1.Enabled = False
        lblScale2.Enabled = False
        vlbScaleDraw.Enabled = False
        vlbScalePaper.Enabled = False
        vlbScalePaper.Value = sScales[0]
        vlbScaleDraw.Value = sScales[1]
        radScale.Value = True
    Else
        lblScale1.Enabled = True
        lblScale2.Enabled = True
        vlbScaleDraw.Enabled = True
        vlbScalePaper.Enabled = True
    Endif

End

Public Sub radFitCustom_Click()

    vlbTop.Enabled = True
    vlbLeft.Enabled = True
    lblFit1.Enabled = True
    lblFit2.Enabled = True

End

Public Sub radFit_Click()

    vlbTop.Enabled = False
    vlbLeft.Enabled = False
    lblFit1.Enabled = False
    lblFit2.Enabled = False

End

Public Sub btnPenTableSelection2_Click()

    Me.radAreaWindow.Value = True
    gcd.clsJobCallBack = Me ' necesitamos volver aca luego de que marque un area
    gcd.clsJob = cadSelection
    Me.Close(2)

End
