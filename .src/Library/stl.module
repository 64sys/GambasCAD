' Gambas module file

Public Function LoadBinarySTL(sFileName As String) As Stlmodel3d
    ' UINT8[80]    – Header                 -     80 bytes
    ' UINT32       – Number of triangles    -      4 bytes
    ' foreach triangle                      - 50 bytes:
    '     REAL32[3] – Normal vector             - 12 bytes
    '     REAL32[3] – Vertex 1                  - 12 bytes
    '     REAL32[3] – Vertex 2                  - 12 bytes
    '     REAL32[3] – Vertex 3                  - 12 bytes
    '     UINT16    – Attribute byte count      -  2 bytes
    ' end

    Dim stlmodel As New Stlmodel3d
    Dim t As New Triangle3d
    Dim f As File
    Dim s As String
    Dim iTriangles As Integer, i As Integer
    Dim gSingle As Single, yByte As Byte

    f = Open sFileName For Input
    f.ByteOrder = gb.LittleEndian


    Read #f, s, 80          ' header, se ignora
    Read #f, iTriangles

    stlmodel.triangles.Resize(iTriangles)


    For i = 0 To stlmodel.triangles.Max

        Read #f, gSingle
        stlmodel.triangles[i].normal.x = gSingle
        Read #f, gSingle
        stlmodel.triangles[i].normal.y = gSingle
        Read #f, gSingle
        stlmodel.triangles[i].normal.z = gSingle

        Read #f, gSingle
        stlmodel.triangles[i].vertex1.x = gSingle
        Read #f, gSingle
        stlmodel.triangles[i].vertex1.y = gSingle
        Read #f, gSingle
        stlmodel.triangles[i].vertex1.z = gSingle

        Read #f, gSingle
        stlmodel.triangles[i].vertex2.x = gSingle
        Read #f, gSingle
        stlmodel.triangles[i].vertex2.y = gSingle
        Read #f, gSingle
        stlmodel.triangles[i].vertex2.z = gSingle

        Read #f, gSingle
        stlmodel.triangles[i].vertex3.x = gSingle
        Read #f, gSingle
        stlmodel.triangles[i].vertex3.y = gSingle
        Read #f, gSingle
        stlmodel.triangles[i].vertex3.z = gSingle

        Read #f, yByte
        stlmodel.triangles[i].flag1 = yByte
        Read #f, yByte
        stlmodel.triangles[i].flag2 = yByte

    Next

    f.Close




End