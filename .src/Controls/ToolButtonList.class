' Gambas class file

Export


Inherits UserControl


Public Const _Properties As String = "*,Text,KeepLast,Detatchable"
Public Const _DefaultEvent As String = "Click"
Public Const _DefaultSize As String = "32,32"
Public Const _Similar As String = "ToolButton"


Event Click

Property DefaultButton As Integer
Property KeepLast As Boolean
Property ListDirection As Integer   ' 0=vertical 1=horiz 2=square grid

Property Text As String

Private $hPicture As Picture
Private $sText As String

Private $bState As Boolean
Private $DefaultButton As Integer
Private $KeepLast As Boolean
Private $ListDirection As Integer

Private $Detatchable As Boolean

Private hForm As DrawingArea      ' the form containing the list
Private hObs As Observer

Private H0 As Integer
Private W0 As Integer

Public tbnChilds As New ToolButton[]
Private Toggle As ToggleButton

Private LastButton As Integer     ' the last button pressed

Public Detatched As Boolean       ' if the form will remain out there

Public Direction As Integer       ' 0=horizontal 1=vertical


Public Sub _new()



  hForm = New DrawingArea(Me) As "da"

  ' hForm.Background = Color.Red
  ' hForm.Ignore = True     ' evitamos q fMain lo acomode
  'hForm.Visible = False    ' no es el momento de mostrarlo
  ' hForm.AutoResize = True
  Me.Proxy = hForm

  Me.Ignore = True


  hObs = New Observer(hForm)

End



Public Sub buttons_click()


  Me.Action = Last.Action
  'Debug "Last action", tbnChilds.Last.action, "from", tbnChilds.Last.Name
  Toggle.Value = 0
  Raise Click


End





Public Function AddToolButton(sName As String, Optional sText As String = "", hPicture As Picture, sAction As String = "") As ToolButton


  Dim newTBN As New ToolButton(hForm) As "buttons"

  ' vemos si hace falta inicializar
  If tbnChilds.Count = 0 Then
    Toggle = New ToggleButton(hForm) As "tb"

    h0 = Me.H
    w0 = Me.W

    hForm.Ignore = True
    Toggle.H = Me.H
    Toggle.w = Me.W

    Toggle.Proxy = hForm
    ' hForm.top = Me.Top
    ' hForm.Left = Me.Left
    '
    'tbnChilds.Add(Toggle)
    Toggle.Picture = hPicture
  Endif

  newTBN.Name = sName
  newTBN.Action = sAction
  newTBN.Text = sText
  newTBN.w = Me.W
  newTBN.h = Me.H

  newTBN.Picture = hPicture
  newTBN.Refresh

  tbnChilds.Add(newTBN)

  ' con cada boton agregado, aumento el tamano del form padre

  Select Case $ListDirection
    Case 0 ' se despliega hacia abajo
      ' cambio el tamanio del formulario
      hForm.Height = (tbnChilds.Count + 1) * Me.H
      hForm.Width = Me.W
      ' ubico el boton
      newTBN.Top = (tbnChilds.Max + 1) * Me.H
      newTBN.Left = 0

    Case 1 ' se despliega hacia la derecha
      hForm.Height = Me.Height
      hForm.Width = Me.w * (tbnChilds.Count + 1)
      ' ubico el boton
      newTBN.Top = (tbnChilds.Max + 1) * Me.H
      newTBN.Left = 0

  End Select



End

Public Sub tb_Click()

  ' cambio el tamanio del contenedor

  If Toggle.Value Then

    Select Case $ListDirection
      Case 0 ' se despliega hacia abajo
        ' cambio el tamanio del formulario

        Me.Width = 32
        Me.H = Me.W * (tbnChilds.Count + 1) * Me.H


      Case 1 ' se despliega hacia la derecha
        hForm.Height = Me.Height
        hForm.Width = Me.w * (tbnChilds.Count + 1)

    End Select

  Else
    Me.Width = w0
    Me.H = h0

  Endif



End



Private Function Picture_Read() As Picture

  Return $hPicture

End

Private Sub Picture_Write(Value As Picture)

  $hPicture = Value

End


Private Function Text_Read() As String

  Return $sText

End

Private Sub Text_Write(Value As String)

  $sText = Value

End


Private Function DefaultButton_Read() As Integer



End

Private Sub DefaultButton_Write(Value As Integer)



End


Private Function KeepLast_Read() As Boolean



End

Private Sub KeepLast_Write(Value As Boolean)



End

Private Function ListDirection_Read() As Integer



End

Private Sub ListDirection_Write(Value As Integer)



End

Private Function Detatchable_Read() As Boolean



End

Private Sub Detatchable_Write(Value As Boolean)



End



'
' Private Function sAction_Read() As String
'
'   Dim iButton As Integer
'
'   Return hForm.Last.Action
'
'   Return ""
'
' End



Public Sub da_MouseDown()

  ' aqui tenemos que mostrar el resto de los botones?


  $bState = True
  hForm.Refresh
  'Raise Click

End

Public Sub da_MouseUp()

  $bState = False
  hForm.Refresh

End


Public Sub da_Click()

  $bState = False
  hForm.Refresh

End



Public Sub da_Enter()



  hForm.Refresh

End

Public Sub da_Leave()

  hForm.Refresh

End

Public Sub da_GotFocus()

  hForm.Refresh

End

Public Sub da_LostFocus()

  hForm.Refresh

End
